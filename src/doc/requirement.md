
## 大老二撲克牌遊戲需求文件

### 魔王題介紹

- **難度**：★★☆☆☆
- **挑戰**：自主分析需求中的 Forces，套用合適的設計模式。
- **目標**：開發一款具備擴充性的「大老二」撲克牌遊戲。

---

### 遊戲概述

- **名稱**：大老二 (Big-2)
- **特點**：因為遊戲中最大的數字是 2，故名「大老二」。
- **挑戰性**：
    - 邏輯複雜度高於一般企業商業邏輯。
    - 涉及多個行為變動性 Forces。

---

### 詞彙表 (Glossary)

| 名詞 | 定義 |
| :-- | :-- |
| Big-2 | 大老二撲克牌遊戲。 |
| 玩家 (Player) | 遊戲參與者，可為 AI 或人類玩家。 |
| 撲克牌 (Card) | 為 (數字、花色) 的組合。 |
| 數字 (Rank) | 撲克牌上的數字，範圍為 {3,4,5,...,10,J,Q,K,A,2}。 |
| 花色 (Suit) | 撲克牌上的花色，範圍為 {梅花(♣),菱形(♦),愛心(♥),黑桃(♠)}。 |
| 牌堆 (Deck) | 一副 52 張不同撲克牌的牌堆。 |
| 發牌 (Deal) | 玩家從牌堆頂部取走一張牌。 |
| 手牌 (Hand cards) | 玩家擁有的手牌，最少 0 張，最多 13 張。 |
| 牌型 (Card Pattern) | 撲克牌的組合。 |
| 打牌 (Play) | 玩家從手牌中打出合法牌型至檯面上的動作。 |
| 回合 (Round) | 四位玩家輪流打牌，直到有三位玩家連續喊 PASS 為止。 |
| 頂牌 Top play | 檯面上目前最大的牌型。 |
| 頂牌玩家 Top player | 打出頂牌的玩家。 |

---

### 遊戲流程

1. **玩家初始化**：
    - 四位玩家輸入名稱，用索引值 {0,1,2,3} 表示。
    - 洗牌並將 52 張牌輪流發給四位玩家。 假設目前輪到了玩家 i
      ，則「下一輪的玩家」為索引值(i+ 1)% 4 的玩家
2. **第一回合**：
    - 擁有梅花3的玩家首先出牌，需包含梅花3且合法。
    - 下一輪玩家可選擇：
        - 喊 PASS，放棄出牌機會。
        - 打出比頂牌大的合法牌型。
3. **後續回合**：
    - 每回合結束後檯面上的牌清空。
    - 上一回合的頂牌玩家成為新回合的首位出牌者，且不能喊 PASS。
4. **遊戲結束**：
    - 任一玩家手牌打完即結束，該玩家成為勝利者。
---
### 牌型及大小比較規則

1. **單張 (Single)**：
    - 比較規則：先比數字，再比花色。
    - 數字大小：3 < 4 < ... < J < Q < K < A < 2。
    - 花色大小：梅花 < 菱形 < 愛心 < 黑桃。
2. **對子 (Pair)**：
    - 規則：兩張數字相同的牌。
    - 比較基準：較大的那張牌。
3. **順子 (Straight)**：
    - 規則：連續數字的五張牌。
    - 比較基準：最大的那張牌。
4. **葫蘆 (Full house)**：
    - 規則：五張牌，由三張相同數字和兩張相同數字組成。
    - 比較基準：三張相同數字中的最大值。

---

### 軟體設計需求

#### 開閉原則 (Open-Closed Principle, OCP)

- **要求**：
    - 擴充新牌型或刪除既有牌型時，不需修改既有類別程式。
- **提示**：
    - 可參考已學過的設計模式（策略模式、樣板方法、責任鍊模式）。

---

### 輸入格式

```
<洗好的牌堆>
<玩家 0 的名字>
<玩家 1 的名字>
<玩家 2 的名字>
<玩家 3 的名字>
<欲執行的動作 1>
<欲執行的動作 2>
<欲執行的動作 3>
...
```
1. 第一行：洗好的牌堆

```
<洗好的牌堆> := <花色>[<數字>] <花色>[<數字>] ... <花色>[<數字>]
```

### 牌堆與卡牌表示方式

**花色對照表**：


| 代號 | 花色名稱 |
| :-- | :-- |
| C | 梅花(♣) |
| D | 菱形(♦) |
| H | 愛心(♥) |
| S | 黑桃(♠) |

**數字範圍**：
`3,4,5,6,7,8,9,10,J,Q,K,A,2`

### 輸入格式規範

#### 牌堆格式

```text
&lt;花色&gt;[&lt;數字&gt;] &lt;花色&gt;[&lt;數字&gt;] ... (共52張)
```

- **範例**：`C D[Q] S[^2] H[A]...`
- **重要說明**：
    - 最左側為牌堆底部，最右側為牌堆頂部
    - 發牌時從頂部開始取牌
    - 每張卡牌間以空格分隔


#### 玩家名稱

```text
&lt;玩家0名稱&gt;
&lt;玩家1名稱&gt;
&lt;玩家2名稱&gt;
&lt;玩家3名稱&gt;
```

- **命名規則**：
    - 可包含：大小寫字母、數字、中文字符
    - 區分大小寫
    - 長度不限


#### 玩家動作指令

| 指令類型 | 格式 | 說明 |
| :-- | :-- | :-- |
| PASS | `-1` | 放棄出牌機會 |
| 出牌 | `0 2 5` | 使用索引0,2,5的手牌組合出牌 |
| **特殊規則**：新回合首位玩家不可PASS |  |  |

### 輸出格式規範

#### 回合流程提示

```text
新的回合開始了。
輪到&lt;玩家名稱&gt;了
```


#### 手牌顯示格式

```text
0    1    2    3    4    5    6     7 ...
S[^3] H[^4] S[^4] H[^6] H[^7] C[^8] C[^10] S[K] ...
```

- **顯示規則**：
    - 索引列左對齊固定寬度
    - 手牌依序由小到大排序顯示
    - 每張卡牌間隔一個空格


#### 操作反饋訊息

| 情境 | 輸出格式 |
| :-- | :-- |
| 合法出牌 | `玩家 &lt;名稱&gt; 打出了 &lt;牌型&gt; &lt;卡牌列表&gt;` |
| 非法出牌 | `此牌型不合法，請再嘗試一次` |
| 合法PASS | `玩家 &lt;名稱&gt; PASS.` |
| 非法PASS | `你不能在新的回合中喊 PASS` |
| 遊戲結束 | `遊戲結束，遊戲的勝利者為 &lt;名稱&gt;` |

### 執行流程圖解

```mermaid
graph TD
    A[輸入牌堆] --&gt; B[初始化四位玩家]
    B --&gt; C{檢查梅花3持有者}
    C --&gt; D[第一回合開始]
    D --&gt; E[輪流出牌驗證]
    E --&gt; F{符合結束條件?}
    F --是--&gt; G[清空檯面開始新回合]
    F --否--&gt; H[持續進行回合]
    H --&gt; I{玩家出完手牌?}
    I --是--&gt; J[宣布勝利者]
```


### 重點注意事項

1. **牌堆順序**：輸入時最右側卡牌為牌堆頂部
2. **手牌索引**：從0開始連續編號，出牌時需指定完整組合索引
3. **強制驗證**：每個動作需驗證合法性後才能輪到下一玩家
4. **排序規則**：手牌顯示時需依「數字→花色」雙重排序
5. **特殊限制**：新回合第一位玩家不可PASS

> 💡 開發提示：建議使用「策略模式」處理不同牌型判斷，以符合OCP原則。當新增牌型時，只需擴充新策略類別，無需修改既有核心邏輯。
---

### 輸出格式

1. 回合開始時：

```
新的回合開始了。
```

2. 輪到某玩家時：

```
輪到<玩家的名字>了
```

3. 玩家手牌展示（索引置左對齊）：

```
0    1    2    ...
S[^3] H[^4] S[^4] ...
```

4. 玩家動作結果：
    - 合法出牌：

```
玩家 <玩家的名字> 打出了 <牌型名稱> <花色>[<數字>] <花色>[<數字>] <花色>[<數字>] ...

```
 - <牌型名稱> 為該牌型的中文名稱，可能為單張、對子、順子或是葫蘆。
 - <牌型名稱> 隨後接著的是牌型中包含的牌，以小到大依序由左至右排序。

    - 不合法出牌：

```
此牌型不合法，請再嘗試一次。
```

    - 合法 PASS：

```
玩家 <玩家的名字> PASS.
```

    - 不合法 PASS（新回合第一輪）：

```
你不能在新的回合中喊 PASS
```

5. 遊戲結束時：

```
遊戲結束，遊戲的勝利者為 <玩家的名字>
```


---

### 範例輸入與輸出

#### 範例輸入

```
S[^8] S[^9] S[^3] D[J] S[^7] H[^3] C[^2] C[^9] H[^2] ...
水球
火球
保齡球
地瓜球
0
0
3
...
```


#### 範例輸出

```
新的回合開始了。
輪到地瓜球了
0    1    2    ...
C[^3] C[^4] S[^7] ...
玩家 地瓜球 打出了 單張 C[^3]
...
遊戲結束，遊戲的勝利者為 地瓜球
```

---

以上整理提供清晰的架構和格式，方便快速理解需求內容並進行開發！

<div>⁂</div>
